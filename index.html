<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Optimizador de Patrimonio Avanzado</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --success: #2ecc71;
            --warning: #f39c12;
            --light: #ecf0f1;
            --dark: #34495e;
            --text: #2c3e50;
            --background: #f8f9fa;
            --card-bg: #ffffff;
            --border: #ddd;
            --fire-lean: #3498db;
            --fire-barista: #9b59b6;
            --fire-coast: #2ecc71;
            --fire-full: #e67e22;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            color: var(--text);
            background-color: var(--background);
            line-height: 1.6;
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background-color: var(--primary);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .language-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-selector select {
            padding: 8px 12px;
            border-radius: 4px;
            border: none;
            background-color: var(--dark);
            color: white;
            cursor: pointer;
        }

        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 3rem 0;
            text-align: center;
        }

        .hero h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.2rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin: 1.5rem 0;
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary);
            border-bottom: 2px solid var(--secondary);
            padding-bottom: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 1rem;
        }

        button {
            background-color: var(--secondary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: var(--primary);
        }

        .btn-calculate {
            background-color: var(--success);
            font-size: 1.1rem;
            padding: 15px 25px;
            display: block;
            margin: 2rem auto;
        }

        .btn-calculate:hover {
            background-color: #27ae60;
        }

        .btn-download {
            background-color: var(--accent);
            margin-left: 10px;
        }

        .results {
            display: none;
        }

        .score {
            text-align: center;
            margin: 2rem 0;
        }

        .score-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--secondary);
        }

        .score-max {
            font-size: 1.5rem;
            color: var(--dark);
        }

        .distribution-chart {
            height: 300px;
            margin: 2rem 0;
        }

        .progress-bar {
            height: 25px;
            background-color: #e9ecef;
            border-radius: 4px;
            margin-bottom: 1rem;
            overflow: hidden;
        }

        .progress-bar-fill {
            height: 100%;
            background-color: var(--secondary);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .dca-box {
            background-color: #f8f9fa;
            border-left: 4px solid var(--secondary);
            padding: 1rem;
            margin: 1rem 0;
            display: none;
        }

        .asset-row {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
            gap: 10px;
        }

        .asset-input {
            flex: 2;
        }

        .percentage-input {
            flex: 1;
        }

        .add-asset {
            background-color: var(--warning);
            margin-top: 0.5rem;
        }

        .time-slider {
            margin: 2rem 0;
        }

        .simulation-result {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin: 2rem 0;
        }

        .simulation-card {
            flex: 1;
            min-width: 250px;
            text-align: center;
            padding: 1.5rem;
            border-radius: 8px;
            background-color: var(--light);
        }

        .simulation-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .scenario-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .scenario-tab {
            padding: 10px 20px;
            background-color: var(--light);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .scenario-tab.active {
            background-color: var(--secondary);
            color: white;
        }

        .fire-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 2rem 0;
        }

        .fire-card {
            padding: 1.5rem;
            border-radius: 8px;
            text-align: center;
            color: white;
        }

        .fire-card.lean {
            background-color: var(--fire-lean);
        }

        .fire-card.barista {
            background-color: var(--fire-barista);
        }

        .fire-card.coast {
            background-color: var(--fire-coast);
        }

        .fire-card.full {
            background-color: var(--fire-full);
        }

        .fire-card h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .fire-card .value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .tax-impact {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .heatmap {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 1rem 0;
        }

        .heatmap-item {
            padding: 1rem;
            border-radius: 4px;
            text-align: center;
            background-color: var(--light);
        }

        .heatmap-item.low-risk {
            background-color: #d4edda;
            color: #155724;
        }

        .heatmap-item.medium-risk {
            background-color: #fff3cd;
            color: #856404;
        }

        .heatmap-item.high-risk {
            background-color: #f8d7da;
            color: #721c24;
        }

        .savings-goals, .future-events {
            margin: 1.5rem 0;
        }

        .goal-item, .event-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .goal-item:last-child, .event-item:last-child {
            border-bottom: none;
        }

        footer {
            background-color: var(--primary);
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }

        .tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .tab.active {
            background-color: var(--secondary);
            color: white;
            border-radius: 4px 4px 0 0;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .simulation-result {
                flex-direction: column;
            }
            
            .asset-row {
                flex-direction: column;
                align-items: stretch;
            }

            .scenario-tabs {
                flex-wrap: wrap;
            }

            .fire-results {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">Optimizador de Patrimonio Avanzado</div>
            <div class="language-selector">
                <select id="languageSelector">
                    <option value="es">Español</option>
                    <option value="en">English</option>
                </select>
                <button id="saveScenario">Guardar Escenario</button>
                <button id="loadScenario">Cargar Escenario</button>
                <button id="downloadPDF" class="btn-download">Descargar PDF</button>
            </div>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <h1 id="heroTitle">Optimiza tu Patrimonio y Alcanza tu Independencia Financiera</h1>
            <p id="heroText">Analiza y mejora la distribución de tu cash para alcanzar tus objetivos financieros con nuestro sistema de evaluación integral.</p>
        </div>
    </section>

    <div class="container">
        <div class="tabs">
            <div class="tab active" data-tab="financial-profile">Perfil Financiero</div>
            <div class="tab" data-tab="current-assets">Patrimonio Actual</div>
            <div class="tab" data-tab="dca">DCA</div>
            <div class="tab" data-tab="fire-goals">Metas FIRE</div>
            <div class="tab" data-tab="taxes">Impuestos</div>
            <div class="tab" data-tab="scenarios">Escenarios</div>
            <div class="tab" data-tab="events">Eventos Futuros</div>
        </div>

        <div class="tab-content active" id="financial-profile">
            <div class="card">
                <h2 class="card-title" id="financialProfileTitle">Perfil Financiero</h2>
                <div class="form-group">
                    <label for="monthlyExpenses" id="monthlyExpensesLabel">Gastos Mensuales (€):</label>
                    <input type="number" id="monthlyExpenses" min="0" value="2000">
                </div>
                <div class="form-group">
                    <label for="annualIncome" id="annualIncomeLabel">Ingresos Anuales (€):</label>
                    <input type="number" id="annualIncome" min="0" value="40000">
                </div>
                <div class="form-group">
                    <label for="riskProfile" id="riskProfileLabel">Perfil de Riesgo:</label>
                    <select id="riskProfile">
                        <option value="conservative" id="conservativeOption">Conservador (6-12 meses)</option>
                        <option value="aggressive" id="aggressiveOption">Agresivo (3-6 meses)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="inflationRate" id="inflationRateLabel">Tasa de Inflación (%):</label>
                    <input type="number" id="inflationRate" min="0" step="0.1" value="3.5">
                </div>
            </div>
        </div>

        <div class="tab-content" id="current-assets">
            <div class="card">
                <h2 class="card-title" id="currentAssetsTitle">Patrimonio Actual</h2>
                <div class="form-group">
                    <label for="totalAssets" id="totalAssetsLabel">Patrimonio Total (€):</label>
                    <input type="number" id="totalAssets" min="0" value="50000">
                </div>
                
                <h3 id="distributionTitle">Distribución Actual</h3>
                
                <div class="form-group">
                    <label for="checkingAccount" id="checkingAccountLabel">Cuenta Corriente (0%):</label>
                    <input type="number" id="checkingAccount" min="0" value="5000">
                </div>
                
                <div class="form-group">
                    <label for="remuneratedAccount" id="remuneratedAccountLabel">Cuenta Remunerada (2%):</label>
                    <input type="number" id="remuneratedAccount" min="0" value="10000">
                    <div class="form-group sub-input">
                        <label for="remuneratedAccountRate" id="remuneratedAccountRateLabel">Tasa de interés (%):</label>
                        <input type="number" id="remuneratedAccountRate" min="0" step="0.1" value="2">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="fixedIncome" id="fixedIncomeLabel">Renta Fija:</label>
                    <input type="number" id="fixedIncome" min="0" value="15000">
                    <div class="form-group sub-input">
                        <label for="fixedIncomeRate" id="fixedIncomeRateLabel">Rendimiento esperado (%):</label>
                        <input type="number" id="fixedIncomeRate" min="0" step="0.1" value="3.5">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="equities" id="equitiesLabel">Renta Variable (fondos indexados/acciones):</label>
                    <input type="number" id="equities" min="0" value="15000">
                    <div class="form-group sub-input">
                        <label for="equitiesRate" id="equitiesRateLabel">Rendimiento esperado (%):</label>
                        <input type="number" id="equitiesRate" min="0" step="0.1" value="7">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="realEstate" id="realEstateLabel">Inmobiliario:</label>
                    <input type="number" id="realEstate" min="0" value="3000">
                    <div class="form-group sub-input">
                        <label for="realEstateRate" id="realEstateRateLabel">Rendimiento esperado (%):</label>
                        <input type="number" id="realEstateRate" min="0" step="0.1" value="5">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="crypto" id="cryptoLabel">Criptomonedas:</label>
                    <input type="number" id="crypto" min="0" value="2000">
                    <div class="form-group sub-input">
                        <label for="cryptoRate" id="cryptoRateLabel">Rendimiento esperado (%):</label>
                        <input type="number" id="cryptoRate" min="0" step="0.1" value="12">
                    </div>
                </div>

                <div class="form-group">
                    <label for="otherAssets" id="otherAssetsLabel">Otros Activos:</label>
                    <input type="number" id="otherAssets" min="0" value="0">
                    <div class="form-group sub-input">
                        <label for="otherAssetsRate" id="otherAssetsRateLabel">Rendimiento esperado (%):</label>
                        <input type="number" id="otherAssetsRate" min="0" step="0.1" value="4">
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-content" id="dca">
            <div class="card">
                <h2 class="card-title" id="dcaTitle">DCA (Promedio de Costo en Dólares)</h2>
                <div class="form-group">
                    <label for="dcaAmount" id="dcaAmountLabel">Cantidad Mensual de DCA (€):</label>
                    <input type="number" id="dcaAmount" min="0" value="500">
                </div>
                
                <div id="dcaBox" class="dca-box">
                    <h3 id="dcaDistributionLabel">Distribución del DCA:</h3>
                    <div class="asset-row">
                        <div class="asset-input">
                            <select class="dca-asset-type">
                                <option value="remuneratedAccount" id="dcaRemuneratedOption">Cuenta Remunerada</option>
                                <option value="fixedIncome" id="dcaFixedIncomeOption">Renta Fija</option>
                                <option value="equities" id="dcaEquitiesOption">Renta Variable</option>
                                <option value="realEstate" id="dcaRealEstateOption">Inmobiliario</option>
                                <option value="crypto" id="dcaCryptoOption">Criptomonedas</option>
                                <option value="otherAssets" id="dcaOtherOption">Otros Activos</option>
                            </select>
                        </div>
                        <div class="percentage-input">
                            <input type="number" class="dca-percentage" min="0" max="100" placeholder="%" value="100">
                        </div>
                    </div>
                    <button class="add-asset" id="addAssetButton">+ Añadir otro activo</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="fire-goals">
            <div class="card">
                <h2 class="card-title" id="fireGoalsTitle">Metas FIRE (Independencia Financiera)</h2>
                
                <div class="form-group">
                    <label for="fireGoal" id="fireGoalLabel">Objetivo FIRE:</label>
                    <select id="fireGoal">
                        <option value="lean" id="fireLeanOption">FIRE Lean (gastos anuales × 25)</option>
                        <option value="barista" id="fireBaristaOption">Barista FIRE (gastos anuales × 25 + ingresos parciales)</option>
                        <option value="coast" id="fireCoastOption">Coast FIRE (suficiente para retiro sin más aportaciones)</option>
                        <option value="full" id="fireFullOption">Full FIRE (gastos anuales × 30-40)</option>
                        <option value="custom" id="fireCustomOption">Personalizado</option>
                    </select>
                </div>
                
                <div class="form-group" id="customFireGoalContainer" style="display: none;">
                    <label for="customFireGoal" id="customFireGoalLabel">Monto objetivo personalizado (€):</label>
                    <input type="number" id="customFireGoal" min="0" value="600000">
                </div>
                
                <div class="form-group">
                    <label for="currentAge" id="currentAgeLabel">Edad actual:</label>
                    <input type="number" id="currentAge" min="18" max="100" value="35">
                </div>
                
                <div class="form-group">
                    <label for="retirementAge" id="retirementAgeLabel">Edad de retiro deseada:</label>
                    <input type="number" id="retirementAge" min="18" max="100" value="55">
                </div>
            </div>
        </div>

        <div class="tab-content" id="taxes">
            <div class="card">
                <h2 class="card-title" id="taxesTitle">Impuestos</h2>
                
                <div class="form-group">
                    <label for="taxRate" id="taxRateLabel">Tipo impositivo efectivo (%):</label>
                    <input type="number" id="taxRate" min="0" max="100" step="0.1" value="30">
                </div>
                
                <div class="form-group">
                    <label for="taxTreatment" id="taxTreatmentLabel">Tratamiento fiscal preferente:</label>
                    <select id="taxTreatment">
                        <option value="standard" id="taxStandardOption">Tributación estándar</option>
                        <option value="deferred" id="taxDeferredOption">Fondos de inversión (diferido)</option>
                        <option value="exempt" id="taxExemptOption">Cuentas pensiones (exento hasta límite)</option>
                    </select>
                </div>
                
                <div class="tax-impact">
                    <h4 id="taxImpactTitle">Impacto Fiscal Estimado</h4>
                    <p id="taxImpactText">El impacto fiscal se calculará después de introducir todos los datos.</p>
                </div>
            </div>
        </div>

        <div class="tab-content" id="scenarios">
            <div class="card">
                <h2 class="card-title" id="scenariosTitle">Escenarios</h2>
                
                <div class="scenario-tabs">
                    <div class="scenario-tab active" data-scenario="conservative">Conservador</div>
                    <div class="scenario-tab" data-scenario="moderate">Moderado</div>
                    <div class="scenario-tab" data-scenario="aggressive">Agresivo</div>
                </div>
                
                <div class="form-group">
                    <label for="scenarioName" id="scenarioNameLabel">Nombre del escenario:</label>
                    <input type="text" id="scenarioName" value="Mi Escenario">
                </div>
                
                <div class="form-group">
                    <button id="compareScenarios">Comparar Escenarios</button>
                    <button id="resetScenarios">Reiniciar Escenarios</button>
                </div>
            </div>
        </div>

        <div class="tab-content" id="events">
            <div class="card">
                <h2 class="card-title" id="eventsTitle">Eventos Futuros y Metas de Ahorro</h2>
                
                <div class="savings-goals">
                    <h3 id="savingsGoalsTitle">Metas de Ahorro</h3>
                    <div class="form-group">
                        <label for="goalName" id="goalNameLabel">Nombre de la meta:</label>
                        <input type="text" id="goalName" placeholder="Ej: Entrada para vivienda">
                    </div>
                    <div class="form-group">
                        <label for="goalAmount" id="goalAmountLabel">Cantidad objetivo (€):</label>
                        <input type="number" id="goalAmount" min="0" value="30000">
                    </div>
                    <div class="form-group">
                        <label for="goalYears" id="goalYearsLabel">Años para alcanzar la meta:</label>
                        <input type="number" id="goalYears" min="1" value="5">
                    </div>
                    <button id="addGoal">Añadir Meta</button>
                    
                    <div id="goalsList"></div>
                </div>
                
                <div class="future-events">
                    <h3 id="futureEventsTitle">Eventos Futuros</h3>
                    <div class="form-group">
                        <label for="eventName" id="eventNameLabel">Nombre del evento:</label>
                        <input type="text" id="eventName" placeholder="Ej: Boda, Viaje, etc.">
                    </div>
                    <div class="form-group">
                        <label for="eventCost" id="eventCostLabel">Costo estimado (€):</label>
                        <input type="number" id="eventCost" min="0" value="10000">
                    </div>
                    <div class="form-group">
                        <label for="eventYear" id="eventYearLabel">Año del evento:</label>
                        <input type="number" id="eventYear" min="2023" max="2100" value="2025">
                    </div>
                    <button id="addEvent">Añadir Evento</button>
                    
                    <div id="eventsList"></div>
                </div>
            </div>
        </div>

        <button class="btn-calculate" id="calculateButton">Calcular Optimización</button>

        <div id="results" class="results">
            <div class="card">
                <h2 class="card-title" id="resultsTitle">Resultados de la Optimización</h2>
                
                <div class="score">
                    <span class="score-value" id="scoreValue">0</span>
                    <span class="score-max">/ 100</span>
                </div>
                
                <div class="distribution-chart">
                    <canvas id="distributionChart"></canvas>
                </div>
                
                <h3 id="emergencyFundTitle">Fondo de Emergencia</h3>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="emergencyFundProgress" style="width: 0%"></div>
                </div>
                <p id="emergencyFundText">Fondo de emergencia recomendado: €0.00 (0 meses de gastos)</p>
                
                <h3 id="riskHeatmapTitle">Mapa de Calor de Riesgo</h3>
                <div class="heatmap" id="riskHeatmap">
                    <!-- Se generará dinámicamente -->
                </div>
                
                <h3 id="fireResultsTitle">Proyección FIRE</h3>
                <div class="fire-results">
                    <div class="fire-card lean">
                        <h3>Lean FIRE</h3>
                        <p id="leanFireValue" class="value">€0</p>
                        <p id="leanFireYear">Año: -</p>
                    </div>
                    <div class="fire-card barista">
                        <h3>Barista FIRE</h3>
                        <p id="baristaFireValue" class="value">€0</p>
                        <p id="baristaFireYear">Año: -</p>
                    </div>
                    <div class="fire-card coast">
                        <h3>Coast FIRE</h3>
                        <p id="coastFireValue" class="value">€0</p>
                        <p id="coastFireYear">Año: -</p>
                    </div>
                    <div class="fire-card full">
                        <h3>Full FIRE</h3>
                        <p id="fullFireValue" class="value">€0</p>
                        <p id="fullFireYear">Año: -</p>
                    </div>
                </div>
                
                <h3 id="projectionTitle">Proyección de Patrimonio</h3>
                <div class="form-group time-slider">
                    <label for="timeProjection" id="timeProjectionLabel">Años de proyección:</label>
                    <input type="range" id="timeProjection" min="1" max="30" value="10">
                    <span id="timeProjectionValue">10 años</span>
                </div>
                
                <div class="simulation-result">
                    <div class="simulation-card">
                        <h4 id="currentValueTitle">Valor Actual</h4>
                        <p class="simulation-value" id="currentValue">€0.00</p>
                    </div>
                    <div class="simulation-card">
                        <h4 id="projectedValueTitle">Valor Proyectado</h4>
                        <p class="simulation-value" id="projectedValue">€0.00</p>
                    </div>
                    <div class="simulation-card">
                        <h4 id="inflationAdjustedTitle">Ajustado por Inflación</h4>
                        <p class="simulation-value" id="inflationAdjustedValue">€0.00</p>
                    </div>
                    <div class="simulation-card">
                        <h4 id="afterTaxTitle">Después de Impuestos</h4>
                        <p class="simulation-value" id="afterTaxValue">€0.00</p>
                    </div>
                </div>
                
                <div class="distribution-chart">
                    <canvas id="projectionChart"></canvas>
                </div>
                
                <h3 id="sensitivityTitle">Análisis de Sensibilidad</h3>
                <div class="distribution-chart">
                    <canvas id="sensitivityChart"></canvas>
                </div>
                
                <h3 id="recommendationsTitle">Recomendaciones</h3>
                <div id="recommendations">
                    <p id="recommendationsText">Aquí aparecerán recomendaciones personalizadas para optimizar tu patrimonio.</p>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p id="footerText">© 2023 Optimizador de Patrimonio Avanzado. Esta herramienta es solo con fines educativos e informativos. Consulte con un asesor financiero profesional antes de tomar decisiones de inversión.</p>
        </div>
    </footer>

    <script>
        // Textos en diferentes idiomas
        const translations = {
            es: {
                heroTitle: "Optimiza tu Patrimonio y Alcanza tu Independencia Financiera",
                heroText: "Analiza y mejora la distribución de tu cash para alcanzar tus objetivos financieros con nuestro sistema de evaluación integral.",
                financialProfileTitle: "Perfil Financiero",
                monthlyExpensesLabel: "Gastos Mensuales (€):",
                annualIncomeLabel: "Ingresos Anuales (€):",
                riskProfileLabel: "Perfil de Riesgo:",
                conservativeOption: "Conservador (6-12 meses)",
                aggressiveOption: "Agresivo (3-6 meses)",
                inflationRateLabel: "Tasa de Inflación (%):",
                currentAssetsTitle: "Patrimonio Actual",
                totalAssetsLabel: "Patrimonio Total (€):",
                distributionTitle: "Distribución Actual",
                checkingAccountLabel: "Cuenta Corriente (0%):",
                remuneratedAccountLabel: "Cuenta Remunerada (2%):",
                remuneratedAccountRateLabel: "Tasa de interés (%):",
                fixedIncomeLabel: "Renta Fija:",
                fixedIncomeRateLabel: "Rendimiento esperado (%):",
                equitiesLabel: "Renta Variable (fondos indexados/acciones):",
                equitiesRateLabel: "Rendimiento esperado (%):",
                realEstateLabel: "Inmobiliario:",
                realEstateRateLabel: "Rendimiento esperado (%):",
                cryptoLabel: "Criptomonedas:",
                cryptoRateLabel: "Rendimiento esperado (%):",
                otherAssetsLabel: "Otros Activos:",
                otherAssetsRateLabel: "Rendimiento esperado (%):",
                dcaTitle: "DCA (Promedio de Costo en Dólares)",
                dcaAmountLabel: "Cantidad Mensual de DCA (€):",
                dcaDistributionLabel: "Distribución del DCA:",
                addAssetButton: "+ Añadir otro activo",
                fireGoalsTitle: "Metas FIRE (Independencia Financiera)",
                fireGoalLabel: "Objetivo FIRE:",
                fireLeanOption: "FIRE Lean (gastos anuales × 25)",
                fireBaristaOption: "Barista FIRE (gastos anuales × 25 + ingresos parciales)",
                fireCoastOption: "Coast FIRE (suficiente para retiro sin más aportaciones)",
                fireFullOption: "Full FIRE (gastos anuales × 30-40)",
                fireCustomOption: "Personalizado",
                customFireGoalLabel: "Monto objetivo personalizado (€):",
                currentAgeLabel: "Edad actual:",
                retirementAgeLabel: "Edad de retiro deseada:",
                taxesTitle: "Impuestos",
                taxRateLabel: "Tipo impositivo efectivo (%):",
                taxTreatmentLabel: "Tratamiento fiscal preferente:",
                taxStandardOption: "Tributación estándar",
                taxDeferredOption: "Fondos de inversión (diferido)",
                taxExemptOption: "Cuentas pensiones (exento hasta límite)",
                taxImpactTitle: "Impacto Fiscal Estimado",
                taxImpactText: "El impacto fiscal se calculará después de introducir todos los datos.",
                scenariosTitle: "Escenarios",
                scenarioNameLabel: "Nombre del escenario:",
                eventsTitle: "Eventos Futuros y Metas de Ahorro",
                savingsGoalsTitle: "Metas de Ahorro",
                goalNameLabel: "Nombre de la meta:",
                goalAmountLabel: "Cantidad objetivo (€):",
                goalYearsLabel: "Años para alcanzar la meta:",
                futureEventsTitle: "Eventos Futuros",
                eventNameLabel: "Nombre del evento:",
                eventCostLabel: "Costo estimado (€):",
                eventYearLabel: "Año del evento:",
                calculateButton: "Calcular Optimización",
                resultsTitle: "Resultados de la Optimización",
                emergencyFundTitle: "Fondo de Emergencia",
                emergencyFundText: "Fondo de emergencia recomendado: €0.00 (0 meses de gastos)",
                riskHeatmapTitle: "Mapa de Calor de Riesgo",
                fireResultsTitle: "Proyección FIRE",
                projectionTitle: "Proyección de Patrimonio",
                timeProjectionLabel: "Años de proyección:",
                timeProjectionValue: "10 años",
                currentValueTitle: "Valor Actual",
                projectedValueTitle: "Valor Proyectado",
                inflationAdjustedTitle: "Ajustado por Inflación",
                afterTaxTitle: "Después de Impuestos",
                sensitivityTitle: "Análisis de Sensibilidad",
                recommendationsTitle: "Recomendaciones",
                recommendationsText: "Aquí aparecerán recomendaciones personalizadas para optimizar tu patrimonio.",
                footerText: "© 2023 Optimizador de Patrimonio Avanzado. Esta herramienta es solo con fines educativos e informativos. Consulte con un asesor financiero profesional antes de tomar decisiones de inversión."
            },
            en: {
                heroTitle: "Optimize Your Assets and Achieve Financial Independence",
                heroText: "Analyze and improve your cash distribution to achieve your financial goals with our comprehensive evaluation system.",
                financialProfileTitle: "Financial Profile",
                monthlyExpensesLabel: "Monthly Expenses (€):",
                annualIncomeLabel: "Annual Income (€):",
                riskProfileLabel: "Risk Profile:",
                conservativeOption: "Conservative (6-12 months)",
                aggressiveOption: "Aggressive (3-6 months)",
                inflationRateLabel: "Inflation Rate (%):",
                currentAssetsTitle: "Current Assets",
                totalAssetsLabel: "Total Assets (€):",
                distributionTitle: "Current Distribution",
                checkingAccountLabel: "Checking Account (0%):",
                remuneratedAccountLabel: "Remunerated Account (2%):",
                remuneratedAccountRateLabel: "Interest Rate (%):",
                fixedIncomeLabel: "Fixed Income:",
                fixedIncomeRateLabel: "Expected Return (%):",
                equitiesLabel: "Equities (index funds/stocks):",
                equitiesRateLabel: "Expected Return (%):",
                realEstateLabel: "Real Estate:",
                realEstateRateLabel: "Expected Return (%):",
                cryptoLabel: "Cryptocurrencies:",
                cryptoRateLabel: "Expected Return (%):",
                otherAssetsLabel: "Other Assets:",
                otherAssetsRateLabel: "Expected Return (%):",
                dcaTitle: "DCA (Dollar-Cost Averaging)",
                dcaAmountLabel: "Monthly DCA Amount (€):",
                dcaDistributionLabel: "DCA Distribution:",
                addAssetButton: "+ Add Another Asset",
                fireGoalsTitle: "FIRE Goals (Financial Independence)",
                fireGoalLabel: "FIRE Goal:",
                fireLeanOption: "Lean FIRE (annual expenses × 25)",
                fireBaristaOption: "Barista FIRE (annual expenses × 25 + partial income)",
                fireCoastOption: "Coast FIRE (enough to retire without further contributions)",
                fireFullOption: "Full FIRE (annual expenses × 30-40)",
                fireCustomOption: "Custom",
                customFireGoalLabel: "Custom target amount (€):",
                currentAgeLabel: "Current age:",
                retirementAgeLabel: "Desired retirement age:",
                taxesTitle: "Taxes",
                taxRateLabel: "Effective tax rate (%):",
                taxTreatmentLabel: "Preferred tax treatment:",
                taxStandardOption: "Standard taxation",
                taxDeferredOption: "Investment funds (deferred)",
                taxExemptOption: "Pension accounts (exempt up to limit)",
                taxImpactTitle: "Estimated Tax Impact",
                taxImpactText: "Tax impact will be calculated after entering all data.",
                scenariosTitle: "Scenarios",
                scenarioNameLabel: "Scenario name:",
                eventsTitle: "Future Events and Savings Goals",
                savingsGoalsTitle: "Savings Goals",
                goalNameLabel: "Goal name:",
                goalAmountLabel: "Target amount (€):",
                goalYearsLabel: "Years to achieve goal:",
                futureEventsTitle: "Future Events",
                eventNameLabel: "Event name:",
                eventCostLabel: "Estimated cost (€):",
                eventYearLabel: "Event year:",
                calculateButton: "Calculate Optimization",
                resultsTitle: "Optimization Results",
                emergencyFundTitle: "Emergency Fund",
                emergencyFundText: "Recommended emergency fund: €0.00 (0 months of expenses)",
                riskHeatmapTitle: "Risk Heatmap",
                fireResultsTitle: "FIRE Projection",
                projectionTitle: "Assets Projection",
                timeProjectionLabel: "Projection years:",
                timeProjectionValue: "10 years",
                currentValueTitle: "Current Value",
                projectedValueTitle: "Projected Value",
                inflationAdjustedTitle: "Inflation Adjusted",
                afterTaxTitle: "After Taxes",
                sensitivityTitle: "Sensitivity Analysis",
                recommendationsTitle: "Recommendations",
                recommendationsText: "Personalized recommendations to optimize your assets will appear here.",
                footerText: "© 2023 Advanced Assets Optimizer. This tool is for educational and informational purposes only. Consult with a professional financial advisor before making investment decisions."
            }
        };

        // Variables globales
        let currentLanguage = 'es';
        let distributionChart = null;
        let projectionChart = null;
        let sensitivityChart = null;
        let scenarios = {
            conservative: {},
            moderate: {},
            aggressive: {}
        };
        let currentScenario = 'conservative';
        let goals = [];
        let events = [];

        // Cambiar idioma
        function changeLanguage(lang) {
            currentLanguage = lang;
            document.getElementById('languageSelector').value = lang;
            
            // Actualizar todos los textos
            for (const [key, value] of Object.entries(translations[lang])) {
                const element = document.getElementById(key);
                if (element) {
                    if (element.tagName === 'INPUT' && element.placeholder) {
                        element.placeholder = value;
                    } else {
                        element.textContent = value;
                    }
                }
            }
            
            // Recalcular si ya hay resultados mostrados
            if (document.getElementById('results').style.display === 'block') {
                calculateOptimization();
            }
        }

        // Inicializar la aplicación
        function initApp() {
            // Configurar el selector de idioma
            document.getElementById('languageSelector').addEventListener('change', (e) => {
                changeLanguage(e.target.value);
            });
            
            // Configurar pestañas
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    // Desactivar todas las pestañas
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
                    
                    // Activar la pestaña seleccionada
                    tab.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Mostrar/ocultar la caja de DCA
            document.getElementById('dcaAmount').addEventListener('input', (e) => {
                const dcaBox = document.getElementById('dcaBox');
                dcaBox.style.display = e.target.value > 0 ? 'block' : 'none';
            });
            
            // Añadir otro activo al DCA
            document.getElementById('addAssetButton').addEventListener('click', () => {
                const newRow = document.createElement('div');
                newRow.className = 'asset-row';
                newRow.innerHTML = `
                    <div class="asset-input">
                        <select class="dca-asset-type">
                            <option value="remuneratedAccount">${currentLanguage === 'es' ? 'Cuenta Remunerada' : 'Remunerated Account'}</option>
                            <option value="fixedIncome">${currentLanguage === 'es' ? 'Renta Fija' : 'Fixed Income'}</option>
                            <option value="equities">${currentLanguage === 'es' ? 'Renta Variable' : 'Equities'}</option>
                            <option value="realEstate">${currentLanguage === 'es' ? 'Inmobiliario' : 'Real Estate'}</option>
                            <option value="crypto">${currentLanguage === 'es' ? 'Criptomonedas' : 'Cryptocurrencies'}</option>
                            <option value="otherAssets">${currentLanguage === 'es' ? 'Otros Activos' : 'Other Assets'}</option>
                        </select>
                    </div>
                    <div class="percentage-input">
                        <input type="number" class="dca-percentage" min="0" max="100" placeholder="%">
                    </div>
                    <button class="remove-asset">X</button>
                `;
                
                newRow.querySelector('.remove-asset').addEventListener('click', function() {
                    this.parentElement.remove();
                });
                
                document.getElementById('dcaBox').appendChild(newRow);
            });
            
            // Mostrar/ocultar objetivo FIRE personalizado
            document.getElementById('fireGoal').addEventListener('change', (e) => {
                document.getElementById('customFireGoalContainer').style.display = 
                    e.target.value === 'custom' ? 'block' : 'none';
            });
            
            // Añadir meta de ahorro
            document.getElementById('addGoal').addEventListener('click', () => {
                const name = document.getElementById('goalName').value;
                const amount = parseFloat(document.getElementById('goalAmount').value);
                const years = parseInt(document.getElementById('goalYears').value);
                
                if (name && amount > 0 && years > 0) {
                    goals.push({ name, amount, years });
                    updateGoalsList();
                }
            });
            
            // Añadir evento futuro
            document.getElementById('addEvent').addEventListener('click', () => {
                const name = document.getElementById('eventName').value;
                const cost = parseFloat(document.getElementById('eventCost').value);
                const year = parseInt(document.getElementById('eventYear').value);
                
                if (name && cost > 0 && year > 2022) {
                    events.push({ name, cost, year });
                    updateEventsList();
                }
            });
            
            // Cambiar entre escenarios
            document.querySelectorAll('.scenario-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.scenario-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentScenario = tab.getAttribute('data-scenario');
                    loadScenario(currentScenario);
                });
            });
            
            // Guardar escenario
            document.getElementById('saveScenario').addEventListener('click', saveScenario);
            
            // Cargar escenario
            document.getElementById('loadScenario').addEventListener('click', loadScenarioDialog);
            
            // Comparar escenarios
            document.getElementById('compareScenarios').addEventListener('click', compareScenarios);
            
            // Reiniciar escenarios
            document.getElementById('resetScenarios').addEventListener('click', resetScenarios);
            
            // Descargar PDF
            document.getElementById('downloadPDF').addEventListener('click', downloadPDF);
            
            // Calcular optimización
            document.getElementById('calculateButton').addEventListener('click', calculateOptimization);
            
            // Actualizar valor del slider de años
            document.getElementById('timeProjection').addEventListener('input', (e) => {
                document.getElementById('timeProjectionValue').textContent = 
                    `${e.target.value} ${currentLanguage === 'es' ? 'años' : 'years'}`;
                if (document.getElementById('results').style.display === 'block') {
                    calculateProjection();
                }
            });
            
            // Inicializar con el idioma por defecto
            changeLanguage('es');
            
            // Cargar escenarios guardados si existen
            loadSavedScenarios();
        }

        // Actualizar lista de metas
        function updateGoalsList() {
            const goalsList = document.getElementById('goalsList');
            goalsList.innerHTML = '';
            
            goals.forEach((goal, index) => {
                const goalItem = document.createElement('div');
                goalItem.className = 'goal-item';
                goalItem.innerHTML = `
                    <div>
                        <strong>${goal.name}</strong>: €${goal.amount.toFixed(2)} en ${goal.years} ${currentLanguage === 'es' ? 'años' : 'years'}
                    </div>
                    <button class="remove-goal" data-index="${index}">X</button>
                `;
                goalsList.appendChild(goalItem);
            });
            
            // Añadir event listeners a los botones de eliminar
            document.querySelectorAll('.remove-goal').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    goals.splice(index, 1);
                    updateGoalsList();
                });
            });
        }

        // Actualizar lista de eventos
        function updateEventsList() {
            const eventsList = document.getElementById('eventsList');
            eventsList.innerHTML = '';
            
            events.forEach((event, index) => {
                const eventItem = document.createElement('div');
                eventItem.className = 'event-item';
                eventItem.innerHTML = `
                    <div>
                        <strong>${event.name}</strong>: €${event.cost.toFixed(2)} en ${event.year}
                    </div>
                    <button class="remove-event" data-index="${index}">X</button>
                `;
                eventsList.appendChild(eventItem);
            });
            
            // Añadir event listeners a los botones de eliminar
            document.querySelectorAll('.remove-event').forEach(button => {
                button.addEventListener('click', (e) => {
                    const index = parseInt(e.target.getAttribute('data-index'));
                    events.splice(index, 1);
                    updateEventsList();
                });
            });
        }

        // Guardar escenario
        function saveScenario() {
            const scenarioName = document.getElementById('scenarioName').value || currentScenario;
            const scenarioData = {
                monthlyExpenses: parseFloat(document.getElementById('monthlyExpenses').value),
                annualIncome: parseFloat(document.getElementById('annualIncome').value),
                riskProfile: document.getElementById('riskProfile').value,
                inflationRate: parseFloat(document.getElementById('inflationRate').value),
                totalAssets: parseFloat(document.getElementById('totalAssets').value),
                checkingAccount: parseFloat(document.getElementById('checkingAccount').value),
                remuneratedAccount: parseFloat(document.getElementById('remuneratedAccount').value),
                remuneratedAccountRate: parseFloat(document.getElementById('remuneratedAccountRate').value),
                fixedIncome: parseFloat(document.getElementById('fixedIncome').value),
                fixedIncomeRate: parseFloat(document.getElementById('fixedIncomeRate').value),
                equities: parseFloat(document.getElementById('equities').value),
                equitiesRate: parseFloat(document.getElementById('equitiesRate').value),
                realEstate: parseFloat(document.getElementById('realEstate').value),
                realEstateRate: parseFloat(document.getElementById('realEstateRate').value),
                crypto: parseFloat(document.getElementById('crypto').value),
                cryptoRate: parseFloat(document.getElementById('cryptoRate').value),
                otherAssets: parseFloat(document.getElementById('otherAssets').value),
                otherAssetsRate: parseFloat(document.getElementById('otherAssetsRate').value),
                dcaAmount: parseFloat(document.getElementById('dcaAmount').value),
                taxRate: parseFloat(document.getElementById('taxRate').value),
                taxTreatment: document.getElementById('taxTreatment').value,
                fireGoal: document.getElementById('fireGoal').value,
                customFireGoal: parseFloat(document.getElementById('customFireGoal').value),
                currentAge: parseInt(document.getElementById('currentAge').value),
                retirementAge: parseInt(document.getElementById('retirementAge').value)
            };
            
            scenarios[currentScenario] = scenarioData;
            
            // Guardar en localStorage
            localStorage.setItem('financialScenarios', JSON.stringify(scenarios));
            
            alert(currentLanguage === 'es' ? 
                `Escenario "${scenarioName}" guardado correctamente.` :
                `Scenario "${scenarioName}" saved successfully.`);
        }

        // Cargar escenario
        function loadScenario(scenario) {
            const scenarioData = scenarios[scenario];
            if (scenarioData) {
                document.getElementById('monthlyExpenses').value = scenarioData.monthlyExpenses;
                document.getElementById('annualIncome').value = scenarioData.annualIncome;
                document.getElementById('riskProfile').value = scenarioData.riskProfile;
                document.getElementById('inflationRate').value = scenarioData.inflationRate;
                document.getElementById('totalAssets').value = scenarioData.totalAssets;
                document.getElementById('checkingAccount').value = scenarioData.checkingAccount;
                document.getElementById('remuneratedAccount').value = scenarioData.remuneratedAccount;
                document.getElementById('remuneratedAccountRate').value = scenarioData.remuneratedAccountRate;
                document.getElementById('fixedIncome').value = scenarioData.fixedIncome;
                document.getElementById('fixedIncomeRate').value = scenarioData.fixedIncomeRate;
                document.getElementById('equities').value = scenarioData.equities;
                document.getElementById('equitiesRate').value = scenarioData.equitiesRate;
                document.getElementById('realEstate').value = scenarioData.realEstate;
                document.getElementById('realEstateRate').value = scenarioData.realEstateRate;
                document.getElementById('crypto').value = scenarioData.crypto;
                document.getElementById('cryptoRate').value = scenarioData.cryptoRate;
                document.getElementById('otherAssets').value = scenarioData.otherAssets;
                document.getElementById('otherAssetsRate').value = scenarioData.otherAssetsRate;
                document.getElementById('dcaAmount').value = scenarioData.dcaAmount;
                document.getElementById('taxRate').value = scenarioData.taxRate;
                document.getElementById('taxTreatment').value = scenarioData.taxTreatment;
                document.getElementById('fireGoal').value = scenarioData.fireGoal;
                document.getElementById('customFireGoal').value = scenarioData.customFireGoal;
                document.getElementById('currentAge').value = scenarioData.currentAge;
                document.getElementById('retirementAge').value = scenarioData.retirementAge;
                
                // Mostrar/ocultar objetivo FIRE personalizado
                document.getElementById('customFireGoalContainer').style.display = 
                    scenarioData.fireGoal === 'custom' ? 'block' : 'none';
            }
        }

        // Cargar escenarios guardados
        function loadSavedScenarios() {
            const savedScenarios = localStorage.getItem('financialScenarios');
            if (savedScenarios) {
                scenarios = JSON.parse(savedScenarios);
                loadScenario(currentScenario);
            }
        }

        // Diálogo para cargar escenario
        function loadScenarioDialog() {
            // Implementar diálogo para seleccionar escenario
            const scenarioNames = Object.keys(scenarios);
            if (scenarioNames.length === 0) {
                alert(currentLanguage === 'es' ? 
                    "No hay escenarios guardados." :
                    "No saved scenarios.");
                return;
            }
            
            let message = currentLanguage === 'es' ? 
                "Escenarios guardados:\n" :
                "Saved scenarios:\n";
            
            scenarioNames.forEach((name, index) => {
                message += `${index + 1}. ${name}\n`;
            });
            
            const choice = prompt(message + "\n" + (currentLanguage === 'es' ? 
                "Introduce el número del escenario a cargar:" :
                "Enter the number of the scenario to load:"));
            
            const index = parseInt(choice) - 1;
            if (index >= 0 && index < scenarioNames.length) {
                currentScenario = scenarioNames[index];
                loadScenario(currentScenario);
                
                // Actualizar la pestaña activa
                document.querySelectorAll('.scenario-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.getAttribute('data-scenario') === currentScenario) {
                        tab.classList.add('active');
                    }
                });
            }
        }

        // Comparar escenarios
        function compareScenarios() {
            // Implementar comparación de escenarios
            alert(currentLanguage === 'es' ? 
                "Funcionalidad de comparación de escenarios en desarrollo." :
                "Scenario comparison functionality in development.");
        }

        // Reiniciar escenarios
        function resetScenarios() {
            if (confirm(currentLanguage === 'es' ? 
                "¿Estás seguro de que quieres reiniciar todos los escenarios? Se perderán todos los datos guardados." :
                "Are you sure you want to reset all scenarios? All saved data will be lost.")) {
                scenarios = {
                    conservative: {},
                    moderate: {},
                    aggressive: {}
                };
                localStorage.removeItem('financialScenarios');
                loadScenario(currentScenario);
            }
        }

        // Descargar PDF
        function downloadPDF() {
            // Implementar descarga de PDF
            alert(currentLanguage === 'es' ? 
                "Funcionalidad de descarga de PDF en desarrollo." :
                "PDF download functionality in development.");
        }

        // Calcular la optimización
        function calculateOptimization() {
            // Obtener valores de entrada
            const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value) || 0;
            const riskProfile = document.getElementById('riskProfile').value;
            const inflationRate = parseFloat(document.getElementById('inflationRate').value) || 0;
            const totalAssets = parseFloat(document.getElementById('totalAssets').value) || 0;
            
            // Calcular fondo de emergencia recomendado
            const emergencyFundMonths = riskProfile === 'conservative' ? 9 : 4.5; // promedio de 9 meses para conservador, 4.5 para agresivo
            const recommendedEmergencyFund = monthlyExpenses * emergencyFundMonths;
            
            // Calcular distribución actual
            const checkingAccount = parseFloat(document.getElementById('checkingAccount').value) || 0;
            const remuneratedAccount = parseFloat(document.getElementById('remuneratedAccount').value) || 0;
            const fixedIncome = parseFloat(document.getElementById('fixedIncome').value) || 0;
            const equities = parseFloat(document.getElementById('equities').value) || 0;
            const realEstate = parseFloat(document.getElementById('realEstate').value) || 0;
            const crypto = parseFloat(document.getElementById('crypto').value) || 0;
            const otherAssets = parseFloat(document.getElementById('otherAssets').value) || 0;
            
            const totalAllocated = checkingAccount + remuneratedAccount + fixedIncome + equities + realEstate + crypto + otherAssets;
            const unallocated = totalAssets - totalAllocated;
            
            // Calcular puntuación (simplificado)
            let score = 70; // Puntuación base
            
            // Ajustar según el fondo de emergencia
            const emergencyFundRatio = (checkingAccount + remuneratedAccount) / recommendedEmergencyFund;
            if (emergencyFundRatio >= 0.9 && emergencyFundRatio <= 1.1) {
                score += 10;
            } else if (emergencyFundRatio >= 0.7 && emergencyFundRatio < 0.9) {
                score += 5;
            } else if (emergencyFundRatio > 1.1 && emergencyFundRatio <= 1.5) {
                score += 3;
            } else {
                score -= 10;
            }
            
            // Ajustar según diversificación
            const distribution = [remuneratedAccount, fixedIncome, equities, realEstate, crypto, otherAssets];
            const nonZeroAssets = distribution.filter(val => val > 0).length;
            if (nonZeroAssets >= 4) {
                score += 10;
            } else if (nonZeroAssets === 3) {
                score += 5;
            } else if (nonZeroAssets === 2) {
                score += 2;
            } else {
                score -= 5;
            }
            
            // Ajustar según perfil de riesgo
            if (riskProfile === 'conservative' && equities + crypto > 0.3 * totalAssets) {
                score -= 10;
            } else if (riskProfile === 'aggressive' && equities + crypto < 0.4 * totalAssets) {
                score -= 5;
            }
            
            // Asegurar que la puntuación esté entre 0 y 100
            score = Math.max(0, Math.min(100, Math.round(score)));
            
            // Mostrar resultados
            document.getElementById('scoreValue').textContent = score;
            
            // Actualizar gráfico de distribución
            updateDistributionChart(checkingAccount, remuneratedAccount, fixedIncome, equities, realEstate, crypto, otherAssets, unallocated);
            
            // Actualizar información del fondo de emergencia
            const emergencyFundProgress = Math.min(100, (checkingAccount + remuneratedAccount) / recommendedEmergencyFund * 100);
            document.getElementById('emergencyFundProgress').style.width = `${emergencyFundProgress}%`;
            
            document.getElementById('emergencyFundText').textContent = 
                `${currentLanguage === 'es' ? 'Fondo de emergencia recomendado: ' : 'Recommended emergency fund: '}€${recommendedEmergencyFund.toFixed(2)} (${emergencyFundMonths} ${currentLanguage === 'es' ? 'meses de gastos' : 'months of expenses'})`;
            
            // Actualizar mapa de calor de riesgo
            updateRiskHeatmap(checkingAccount, remuneratedAccount, fixedIncome, equities, realEstate, crypto, otherAssets, riskProfile);
            
            // Calcular proyección
            calculateProjection();
            
            // Calcular objetivos FIRE
            calculateFIREGoals();
            
            // Generar recomendaciones
            generateRecommendations();
            
            // Mostrar resultados
            document.getElementById('results').style.display = 'block';
            
            // Scroll a resultados
            document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
        }

        // Actualizar gráfico de distribución
        function updateDistributionChart(checking, remunerated, fixedIncome, equities, realEstate, crypto, otherAssets, unallocated) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            distributionChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: [
                        currentLanguage === 'es' ? 'Cuenta Corriente' : 'Checking Account',
                        currentLanguage === 'es' ? 'Cuenta Remunerada' : 'Remunerated Account',
                        currentLanguage === 'es' ? 'Renta Fija' : 'Fixed Income',
                        currentLanguage === 'es' ? 'Renta Variable' : 'Equities',
                        currentLanguage === 'es' ? 'Inmobiliario' : 'Real Estate',
                        currentLanguage === 'es' ? 'Criptomonedas' : 'Cryptocurrencies',
                        currentLanguage === 'es' ? 'Otros Activos' : 'Other Assets',
                        currentLanguage === 'es' ? 'Sin asignar' : 'Unallocated'
                    ],
                    datasets: [{
                        data: [checking, remunerated, fixedIncome, equities, realEstate, crypto, otherAssets, unallocated],
                        backgroundColor: [
                            '#95a5a6', // checking - gris
                            '#3498db', // remunerated - azul
                            '#2ecc71', // fixed income - verde
                            '#f1c40f', // equities - amarillo
                            '#e67e22', // real estate - naranja
                            '#9b59b6', // crypto - morado
                            '#1abc9c', // otros - turquesa
                            '#e74c3c'  // unallocated - rojo
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `€${value.toFixed(2)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Actualizar mapa de calor de riesgo
        function updateRiskHeatmap(checking, remunerated, fixedIncome, equities, realEstate, crypto, otherAssets, riskProfile) {
            const heatmap = document.getElementById('riskHeatmap');
            heatmap.innerHTML = '';
            
            const total = checking + remunerated + fixedIncome + equities + realEstate + crypto + otherAssets;
            if (total === 0) return;
            
            const assets = [
                { name: currentLanguage === 'es' ? 'Cuenta Corriente' : 'Checking Account', value: checking, risk: 1 },
                { name: currentLanguage === 'es' ? 'Cuenta Remunerada' : 'Remunerated Account', value: remunerated, risk: 2 },
                { name: currentLanguage === 'es' ? 'Renta Fija' : 'Fixed Income', value: fixedIncome, risk: 3 },
                { name: currentLanguage === 'es' ? 'Otros Activos' : 'Other Assets', value: otherAssets, risk: 4 },
                { name: currentLanguage === 'es' ? 'Inmobiliario' : 'Real Estate', value: realEstate, risk: 5 },
                { name: currentLanguage === 'es' ? 'Renta Variable' : 'Equities', value: equities, risk: 7 },
                { name: currentLanguage === 'es' ? 'Criptomonedas' : 'Cryptocurrencies', value: crypto, risk: 9 }
            ];
            
            assets.forEach(asset => {
                const percentage = (asset.value / total) * 100;
                const item = document.createElement('div');
                
                let riskClass = 'low-risk';
                if (asset.risk >= 7) riskClass = 'high-risk';
                else if (asset.risk >= 4) riskClass = 'medium-risk';
                
                item.className = `heatmap-item ${riskClass}`;
                item.innerHTML = `
                    <div>${asset.name}</div>
                    <div>${percentage.toFixed(1)}%</div>
                    <div>${currentLanguage === 'es' ? 'Riesgo ' : 'Risk '}${asset.risk}/10</div>
                `;
                
                heatmap.appendChild(item);
            });
        }

        // Calcular proyección
        function calculateProjection() {
            const years = parseInt(document.getElementById('timeProjection').value);
            const inflationRate = parseFloat(document.getElementById('inflationRate').value) / 100;
            const taxRate = parseFloat(document.getElementById('taxRate').value) / 100;
            
            // Obtener valores actuales y tasas de rendimiento
            const checkingAccount = parseFloat(document.getElementById('checkingAccount').value) || 0;
            const checkingRate = 0; // 0% para cuenta corriente
            
            const remuneratedAccount = parseFloat(document.getElementById('remuneratedAccount').value) || 0;
            const remuneratedRate = parseFloat(document.getElementById('remuneratedAccountRate').value) / 100;
            
            const fixedIncome = parseFloat(document.getElementById('fixedIncome').value) || 0;
            const fixedIncomeRate = parseFloat(document.getElementById('fixedIncomeRate').value) / 100;
            
            const equities = parseFloat(document.getElementById('equities').value) || 0;
            const equitiesRate = parseFloat(document.getElementById('equitiesRate').value) / 100;
            
            const realEstate = parseFloat(document.getElementById('realEstate').value) || 0;
            const realEstateRate = parseFloat(document.getElementById('realEstateRate').value) / 100;
            
            const crypto = parseFloat(document.getElementById('crypto').value) || 0;
            const cryptoRate = parseFloat(document.getElementById('cryptoRate').value) / 100;
            
            const otherAssets = parseFloat(document.getElementById('otherAssets').value) || 0;
            const otherAssetsRate = parseFloat(document.getElementById('otherAssetsRate').value) / 100;
            
            // Obtener datos de DCA
            const dcaAmount = parseFloat(document.getElementById('dcaAmount').value) || 0;
            let dcaAllocations = [];
            
            if (dcaAmount > 0) {
                const dcaRows = document.querySelectorAll('.asset-row');
                dcaRows.forEach(row => {
                    const assetType = row.querySelector('.dca-asset-type').value;
                    const percentage = parseFloat(row.querySelector('.dca-percentage').value) / 100 || 0;
                    if (percentage > 0) {
                        dcaAllocations.push({
                            type: assetType,
                            percentage: percentage,
                            amount: dcaAmount * percentage
                        });
                    }
                });
            }
            
            // Calcular valor actual
            const currentValue = checkingAccount + remuneratedAccount + fixedIncome + equities + realEstate + crypto + otherAssets;
            document.getElementById('currentValue').textContent = `€${currentValue.toFixed(2)}`;
            
            // Calcular proyección año por año
            const yearlyProjection = [];
            const yearlyProjectionAfterTax = [];
            let projectedValue = currentValue;
            let projectedValueAfterTax = currentValue;
            
            for (let year = 1; year <= years; year++) {
                // Calcular crecimiento de las inversiones existentes
                let yearlyGrowth = 0;
                yearlyGrowth += checkingAccount * checkingRate;
                yearlyGrowth += remuneratedAccount * remuneratedRate;
                yearlyGrowth += fixedIncome * fixedIncomeRate;
                yearlyGrowth += equities * equitiesRate;
                yearlyGrowth += realEstate * realEstateRate;
                yearlyGrowth += crypto * cryptoRate;
                yearlyGrowth += otherAssets * otherAssetsRate;
                
                // Aplicar impuestos a las ganancias (simplificado)
                const taxableGrowth = yearlyGrowth - (checkingAccount * checkingRate); // Excluir cuenta corriente
                const taxOnGrowth = taxableGrowth * taxRate;
                const growthAfterTax = yearlyGrowth - taxOnGrowth;
                
                // Añadir DCA y su crecimiento
                let dcaGrowth = 0;
                let dcaGrowthAfterTax = 0;
                dcaAllocations.forEach(allocation => {
                    // Añadir contribuciones DCA de este año
                    const yearlyDCA = allocation.amount * 12;
                    
                    // Calcular crecimiento de las contribuciones anteriores (asumiendo contribuciones mensuales)
                    // Simplificación: crecimiento promedio de la mitad del capital añadido durante el año
                    const assetRate = eval(`${allocation.type}Rate`);
                    dcaGrowth += yearlyDCA * (assetRate / 2);
                    
                    // Aplicar impuestos al crecimiento del DCA
                    const taxOnDCAGrowth = yearlyDCA * (assetRate / 2) * taxRate;
                    dcaGrowthAfterTax += yearlyDCA * (assetRate / 2) - taxOnDCAGrowth;
                    
                    // Añadir la contribución de este año al valor proyectado
                    projectedValue += yearlyDCA;
                    projectedValueAfterTax += yearlyDCA;
                });
                
                // Aplicar crecimiento
                projectedValue += yearlyGrowth + dcaGrowth;
                projectedValueAfterTax += growthAfterTax + dcaGrowthAfterTax;
                
                // Ajustar por eventos futuros (retiros de capital)
                events.forEach(event => {
                    if (event.year === new Date().getFullYear() + year) {
                        projectedValue -= event.cost;
                        projectedValueAfterTax -= event.cost;
                    }
                });
                
                // Guardar proyección para este año
                yearlyProjection.push(projectedValue);
                yearlyProjectionAfterTax.push(projectedValueAfterTax);
            }
            
            // Calcular valor ajustado por inflación
            const inflationAdjustedValue = projectedValue / Math.pow(1 + inflationRate, years);
            const inflationAdjustedValueAfterTax = projectedValueAfterTax / Math.pow(1 + inflationRate, years);
            
            // Mostrar valores proyectados
            document.getElementById('projectedValue').textContent = `€${projectedValue.toFixed(2)}`;
            document.getElementById('inflationAdjustedValue').textContent = `€${inflationAdjustedValue.toFixed(2)}`;
            document.getElementById('afterTaxValue').textContent = `€${projectedValueAfterTax.toFixed(2)}`;
            
            // Actualizar gráfico de proyección
            updateProjectionChart(yearlyProjection, yearlyProjectionAfterTax, years, inflationRate);
            
            // Actualizar análisis de sensibilidad
            updateSensitivityAnalysis(currentValue, years, inflationRate, taxRate);
        }

        // Actualizar gráfico de proyección
        function updateProjectionChart(yearlyProjection, yearlyProjectionAfterTax, years, inflationRate) {
            const ctx = document.getElementById('projectionChart').getContext('2d');
            
            // Calcular valores ajustados por inflación
            const inflationAdjustedProjection = yearlyProjection.map((value, index) => {
                return value / Math.pow(1 + inflationRate, index + 1);
            });
            
            const inflationAdjustedProjectionAfterTax = yearlyProjectionAfterTax.map((value, index) => {
                return value / Math.pow(1 + inflationRate, index + 1);
            });
            
            // Crear etiquetas para los años
            const labels = Array.from({length: years}, (_, i) => i + 1);
            
            if (projectionChart) {
                projectionChart.destroy();
            }
            
            projectionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: currentLanguage === 'es' ? 'Valor Nominal' : 'Nominal Value',
                            data: yearlyProjection,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: currentLanguage === 'es' ? 'Valor después de Impuestos' : 'Value After Taxes',
                            data: yearlyProjectionAfterTax,
                            borderColor: '#9b59b6',
                            backgroundColor: 'rgba(155, 89, 182, 0.1)',
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: currentLanguage === 'es' ? 'Ajustado por Inflación' : 'Inflation Adjusted',
                            data: inflationAdjustedProjection,
                            borderColor: '#e74c3c',
                            backgroundColor: 'rgba(231, 76, 60, 0.1)',
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '€'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: currentLanguage === 'es' ? 'Años' : 'Years'
                            }
                        }
                    }
                }
            });
        }

        // Actualizar análisis de sensibilidad
        function updateSensitivityAnalysis(currentValue, years, inflationRate, taxRate) {
            const ctx = document.getElementById('sensitivityChart').getContext('2d');
            
            // Simular diferentes escenarios de inflación y rendimiento
            const scenarios = [
                { label: currentLanguage === 'es' ? 'Escenario Base' : 'Base Scenario', inf: inflationRate, return: 0.06 },
                { label: currentLanguage === 'es' ? 'Alta Inflación' : 'High Inflation', inf: inflationRate + 0.02, return: 0.06 },
                { label: currentLanguage === 'es' ? 'Baja Inflación' : 'Low Inflation', inf: inflationRate - 0.01, return: 0.06 },
                { label: currentLanguage === 'es' ? 'Alto Rendimiento' : 'High Return', inf: inflationRate, return: 0.08 },
                { label: currentLanguage === 'es' ? 'Bajo Rendimiento' : 'Low Return', inf: inflationRate, return: 0.04 }
            ];
            
            const labels = Array.from({length: years}, (_, i) => i + 1);
            const datasets = scenarios.map((scenario, index) => {
                const data = [];
                let value = currentValue;
                
                for (let i = 0; i < years; i++) {
                    value = value * (1 + scenario.return - scenario.inf);
                    data.push(value);
                }
                
                const colors = ['#3498db', '#e74c3c', '#2ecc71', '#f39c12', '#9b59b6'];
                
                return {
                    label: scenario.label,
                    data: data,
                    borderColor: colors[index],
                    backgroundColor: colors[index] + '20',
                    fill: false,
                    tension: 0.3
                };
            });
            
            if (sensitivityChart) {
                sensitivityChart.destroy();
            }
            
            sensitivityChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: '€'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: currentLanguage === 'es' ? 'Años' : 'Years'
                            }
                        }
                    }
                }
            });
        }

        // Calcular objetivos FIRE
        function calculateFIREGoals() {
            const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value) || 0;
            const annualExpenses = monthlyExpenses * 12;
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const retirementAge = parseInt(document.getElementById('retirementAge').value);
            const yearsToRetirement = retirementAge - currentAge;
            
            const annualIncome = parseFloat(document.getElementById('annualIncome').value) || 0;
            const savingsRate = (annualIncome - annualExpenses) / annualIncome;
            
            // Calcular objetivos FIRE
            const leanFIRE = annualExpenses * 25;
            const baristaFIRE = annualExpenses * 25 * 0.7; // Asumiendo que se cubre el 30% con ingresos
            const coastFIRE = calculateCoastFIRE(annualExpenses, currentAge, retirementAge);
            const fullFIRE = annualExpenses * 33;
            
            // Mostrar valores FIRE
            document.getElementById('leanFireValue').textContent = `€${leanFIRE.toFixed(0)}`;
            document.getElementById('baristaFireValue').textContent = `€${baristaFIRE.toFixed(0)}`;
            document.getElementById('coastFireValue').textContent = `€${coastFIRE.toFixed(0)}`;
            document.getElementById('fullFireValue').textContent = `€${fullFIRE.toFixed(0)}`;
            
            // Calcular años para alcanzar cada objetivo (simplificado)
            const currentAssets = parseFloat(document.getElementById('totalAssets').value) || 0;
            const annualReturn = 0.07; // 7% de retorno anual promedio
            const annualSavings = annualIncome - annualExpenses;
            
            document.getElementById('leanFireYear').textContent = 
                `${currentLanguage === 'es' ? 'Año: ' : 'Year: '}${calculateYearsToGoal(currentAssets, leanFIRE, annualReturn, annualSavings)}`;
            document.getElementById('baristaFireYear').textContent = 
                `${currentLanguage === 'es' ? 'Año: ' : 'Year: '}${calculateYearsToGoal(currentAssets, baristaFIRE, annualReturn, annualSavings)}`;
            document.getElementById('coastFireYear').textContent = 
                `${currentLanguage === 'es' ? 'Año: ' : 'Year: '}${calculateYearsToGoal(currentAssets, coastFIRE, annualReturn, annualSavings)}`;
            document.getElementById('fullFireYear').textContent = 
                `${currentLanguage === 'es' ? 'Año: ' : 'Year: '}${calculateYearsToGoal(currentAssets, fullFIRE, annualReturn, annualSavings)}`;
        }

        // Calcular Coast FIRE
        function calculateCoastFIRE(annualExpenses, currentAge, retirementAge) {
            // Fórmula simplificada para Coast FIRE
            const yearsToRetirement = retirementAge - currentAge;
            const expectedReturn = 0.07; // 7% de retorno anual
            const retirementYears = 30; // Asumiendo 30 años de retiro
            
            const neededAtRetirement = annualExpenses * 25; // Regla del 4%
            return neededAtRetirement / Math.pow(1 + expectedReturn, yearsToRetirement);
        }

        // Calcular años para alcanzar un objetivo
        function calculateYearsToGoal(current, goal, annualReturn, annualSavings) {
            if (current >= goal) return new Date().getFullYear();
            
            let years = 0;
            let value = current;
            
            while (value < goal && years < 60) {
                value = value * (1 + annualReturn) + annualSavings;
                years++;
            }
            
            return new Date().getFullYear() + years;
        }

        // Generar recomendaciones
        function generateRecommendations() {
            const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value) || 0;
            const riskProfile = document.getElementById('riskProfile').value;
            const checkingAccount = parseFloat(document.getElementById('checkingAccount').value) || 0;
            const remuneratedAccount = parseFloat(document.getElementById('remuneratedAccount').value) || 0;
            const emergencyFund = checkingAccount + remuneratedAccount;
            const recommendedEmergencyFund = monthlyExpenses * (riskProfile === 'conservative' ? 9 : 4.5);
            
            const equities = parseFloat(document.getElementById('equities').value) || 0;
            const crypto = parseFloat(document.getElementById('crypto').value) || 0;
            const currentAssets = parseFloat(document.getElementById('totalAssets').value) || 0;
            const riskyAssetsPercentage = (equities + crypto) / currentAssets * 100;
            
            let recommendationsHTML = '';
            
            // Recomendaciones sobre fondo de emergencia
            if (emergencyFund < recommendedEmergencyFund * 0.9) {
                recommendationsHTML += `<p>${currentLanguage === 'es' ? 
                    `🔶 Tu fondo de emergencia (€${emergencyFund.toFixed(2)}) está por debajo de lo recomendado (€${recommendedEmergencyFund.toFixed(2)}). Considera aumentar tus ahorros en cuentas de fácil acceso.` : 
                    `🔶 Your emergency fund (€${emergencyFund.toFixed(2)}) is below the recommended amount (€${recommendedEmergencyFund.toFixed(2)}). Consider increasing your savings in easily accessible accounts.`}</p>`;
            } else if (emergencyFund > recommendedEmergencyFund * 1.5) {
                recommendationsHTML += `<p>${currentLanguage === 'es' ? 
                    `🔶 Tienes un exceso de efectivo en tu fondo de emergencia (€${emergencyFund.toFixed(2)} vs €${recommendedEmergencyFund.toFixed(2)} recomendado). Considera invertir el excedente para obtener mejor rentabilidad.` : 
                    `🔶 You have excess cash in your emergency fund (€${emergencyFund.toFixed(2)} vs €${recommendedEmergencyFund.toFixed(2)} recommended). Consider investing the surplus for better returns.`}</p>`;
            } else {
                recommendationsHTML += `<p>${currentLanguage === 'es' ? 
                    `✅ Tu fondo de emergencia está en un nivel adecuado.` : 
                    `✅ Your emergency fund is at an adequate level.`}</p>`;
            }
            
            // Recomendaciones basadas en el perfil de riesgo
            if (riskProfile === 'conservative' && riskyAssetsPercentage > 30) {
                recommendationsHTML += `<p>${currentLanguage === 'es' ? 
                    `🔶 Para tu perfil conservador, tienes mucho peso en activos de riesgo (${riskyAssetsPercentage.toFixed(1)}%). Considera reducir tu exposición a renta variable y criptomonedas.` : 
                    `🔶 For your conservative profile, you have a high weight in risky assets (${riskyAssetsPercentage.toFixed(1)}%). Consider reducing your exposure to equities and cryptocurrencies.`}</p>`;
            } else if (riskProfile === 'aggressive' && riskyAssetsPercentage < 40) {
                recommendationsHTML += `<p>${currentLanguage === 'es' ? 
                    `🔶 Para tu perfil agresivo, podrías aumentar tu exposición a activos de crecimiento. Actualmente tienes solo un ${riskyAssetsPercentage.toFixed(1)}% en renta variable y criptomonedas.` : 
                    `🔶 For your aggressive profile, you could increase your exposure to growth assets. You currently have only ${riskyAssetsPercentage.toFixed(1)}% in equities and cryptocurrencies.`}</p>`;
            }
            
            // Recomendaciones sobre diversificación
            const assets = [
                parseFloat(document.getElementById('checkingAccount').value) || 0,
                parseFloat(document.getElementById('remuneratedAccount').value) || 0,
                parseFloat(document.getElementById('fixedIncome').value) || 0,
                parseFloat(document.getElementById('equities').value) || 0,
                parseFloat(document.getElementById('realEstate').value) || 0,
                parseFloat(document.getElementById('crypto').value) || 0,
                parseFloat(document.getElementById('otherAssets').value) || 0
            ];
            
            const nonZeroAssets = assets.filter(val => val > 0).length;
            if (nonZeroAssets < 3) {
                recommendationsHTML += `<p>${currentLanguage === 'es' ? 
                    `🔶 Tu cartera tiene poca diversificación (solo ${nonZeroAssets} tipos de activos). Considera diversificar en más clases de activos para reducir el riesgo.` : 
                    `🔶 Your portfolio has low diversification (only ${nonZeroAssets} asset types). Consider diversifying into more asset classes to reduce risk.`}</p>`;
            }
            
            document.getElementById('recommendations').innerHTML = recommendationsHTML;
        }

        // Inicializar cuando el DOM esté cargado
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
